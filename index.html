<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simulatore Esame Farmacologia</title>
    <style>
        :root { --primary: #007aff; --success: #34c759; --error: #ff3b30; --bg: #f2f2f7; }
        body { font-family: -apple-system, system-ui; background-color: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        #app { width: 100%; max-width: 500px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; }
        
        /* Schermate */
        .screen { display: none; }
        .active { display: block; }

        /* Timer e UI */
        #timer { font-weight: bold; color: var(--error); font-size: 1.2rem; text-align: center; margin-bottom: 10px; }
        .question { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; color: #1c1c1e; }
        .options-container { display: flex; flex-direction: column; gap: 10px; }
        .option { padding: 15px; border: 2px solid #e5e5ea; border-radius: 12px; cursor: pointer; text-align: left; background: white; font-size: 1rem; transition: all 0.2s; }
        .option:hover:not(:disabled) { background-color: #f9f9f9; border-color: #d1d1d6; }
        .correct { background-color: var(--success) !important; color: white; border-color: var(--success); }
        .wrong { background-color: var(--error) !important; color: white; border-color: var(--error); }
        
        /* Revisione */
        .review-item { text-align: left; margin-bottom: 15px; padding: 10px; border-bottom: 1px solid #eee; }
        .review-q { font-weight: bold; margin-bottom: 5px; }
        .review-a { color: var(--success); font-weight: 600; }
        .review-user { color: var(--error); }

        button.main-btn { width: 100%; padding: 15px; border: none; border-radius: 12px; background: var(--primary); color: white; font-size: 1.1rem; font-weight: 600; cursor: pointer; margin-top: 20px; }
        button.main-btn:hover { opacity: 0.9; }
    </style>
</head>
<body>

<div id="app">
    <div id="start-screen" class="screen active">
        <h1>Simulatore Farmacologia</h1>
        <p>Il tentativo include domande con risposte a scelta multipla specifiche. Hai 30 minuti di tempo.</p>
        <button class="main-btn" onclick="startAttempt()">Inizia Tentativo</button>
    </div>

    <div id="quiz-screen" class="screen">
        <div id="timer">Tempo: 30:00</div>
        <div id="score-board" style="text-align:right; font-size:0.8rem; color: #888;">Domanda <span id="q-idx">1</span></div>
        <div id="question" class="question"></div>
        <div id="options" class="options-container"></div>
        <button id="next-btn" class="main-btn" style="display:none;" onclick="renderQuestion()">Prossima Domanda</button>
    </div>

    <div id="result-screen" class="screen">
        <h2>Tentativo Completato</h2>
        <p id="final-score" style="font-size: 1.2rem; font-weight: bold;"></p>
        <div id="review-section">
            <h3>Riepilogo Errori:</h3>
            <div id="error-list"></div>
        </div>
        <button class="main-btn" onclick="location.reload()">Nuovo Tentativo</button>
    </div>
</div>

<script>
// --- CONFIGURAZIONE DATI ---
// Inserisci qui le tue domande. 
// 'q': Testo della domanda
// 'options': Array di 4 possibili risposte
// 'correct': Deve essere IDENTICA a una delle stringhe in 'options'

const allQuestions = [
    // --- PATOLOGIA GENERALE: Danno Cellulare e Adattamento ---
    {
        q: "Nel contesto dell'adattamento cellulare, come viene definita la 'metaplasia'?",
        options: [
            "Aumento delle dimensioni delle cellule con conseguente aumento del volume dell'organo",
            "Sostituzione reversibile di un tipo cellulare adulto (epiteliale o mesenchimale) con un altro tipo cellulare adulto",
            "Aumento del numero di cellule in un organo o tessuto",
            "Riduzione delle dimensioni cellulari per perdita di sostanza cellulare"
        ],
        correct: "Sostituzione reversibile di un tipo cellulare adulto (epiteliale o mesenchimale) con un altro tipo cellulare adulto"
    },
    {
        q: "Qual è il segno distintivo morfologico irreversibile che indica il passaggio da danno reversibile a necrosi?",
        options: [
            "Rigonfiamento cellulare (swelling)",
            "Distacco dei ribosomi dal RER",
            "Deplezione dell'ATP",
            "Danno severo alle membrane cellulari e lisosomiali con picnosi/cariolisi nucleare"
        ],
        correct: "Danno severo alle membrane cellulari e lisosomiali con picnosi/cariolisi nucleare"
    },
    {
        q: "Quale delle seguenti affermazioni descrive correttamente l'apoptosi rispetto alla necrosi?",
        options: [
            "L'apoptosi induce sempre una forte risposta infiammatoria",
            "L'apoptosi comporta il rigonfiamento della cellula e la rottura della membrana",
            "L'apoptosi è un processo geneticamente programmato che mantiene l'integrità della membrana plasmatica",
            "L'apoptosi è sempre un processo patologico causato da ipossia"
        ],
        correct: "L'apoptosi è un processo geneticamente programmato che mantiene l'integrità della membrana plasmatica"
    },

    // --- INFIAMMAZIONE E RIPARAZIONE ---
    {
        q: "Quali sono i primi leucociti a essere reclutati nel sito di infiammazione acuta (nelle prime 6-24 ore)?",
        options: [
            "Macrofagi",
            "Linfociti T",
            "Granulociti neutrofili",
            "Eosinofili"
        ],
        correct: "Granulociti neutrofili"
    },
    {
        q: "Il granuloma è la lesione istologica caratteristica di:",
        options: [
            "Infiammazione acuta purulenta",
            "Infiammazione cronica specifica",
            "Edema trasudatizio",
            "Reazione anafilattica di tipo I"
        ],
        correct: "Infiammazione cronica specifica"
    },
    {
        q: "Quale mediatore chimico, derivato dall'acido arachidonico tramite la via della ciclossigenasi, è fondamentale nella genesi della febbre e del dolore?",
        options: [
            "Leucotriene B4",
            "Prostaglandina E2 (PGE2)",
            "Fattore attivante le piastrine (PAF)",
            "Istamina"
        ],
        correct: "Prostaglandina E2 (PGE2)"
    },

    // --- EMODINAMICA E COAGULAZIONE ---
    {
        q: "Quali sono i tre elementi della 'Triade di Virchow' che predispongono alla trombosi?",
        options: [
            "Ipertensione, iperglicemia, iperlipidemia",
            "Danno endoteliale, stasi o turbolenza del flusso, ipercoagulabilità",
            "Infiammazione, necrosi, calcificazione",
            "Vasocostrizione, aggregazione piastrinica, fibrinolisi"
        ],
        correct: "Danno endoteliale, stasi o turbolenza del flusso, ipercoagulabilità"
    },
    {
        q: "Qual è la causa più comune di embolia polmonare?",
        options: [
            "Emboli adiposi da fratture ossee",
            "Trombosi venosa profonda (TVP) degli arti inferiori",
            "Vegetazioni valvolari cardiache",
            "Embolia gassosa da decompressione"
        ],
        correct: "Trombosi venosa profonda (TVP) degli arti inferiori"
    },
    {
        q: "Lo shock settico è caratterizzato principalmente da:",
        options: [
            "Vasocostrizione periferica massiva e aumento della gittata cardiaca",
            "Vasodilatazione periferica, stasi ematica e attivazione/danno endoteliale diffuso da citochine",
            "Perdita massiva di sangue (ipovolemia)",
            "Tamponamento cardiaco"
        ],
        correct: "Vasodilatazione periferica, stasi ematica e attivazione/danno endoteliale diffuso da citochine"
    },

    // --- NEOPLASIE ---
    {
        q: "Quale gene è noto come 'il guardiano del genoma' ed è il gene oncosoppressore più frequentemente mutato nei tumori umani?",
        options: [
            "RAS",
            "MYC",
            "TP53",
            "BCL-2"
        ],
        correct: "TP53"
    },
    {
        q: "Qual è la caratteristica fondamentale che distingue un tumore maligno da uno benigno?",
        options: [
            "La capacità di invadere i tessuti circostanti e metastatizzare",
            "L'alto tasso di proliferazione",
            "La presenza di capsula fibrosa",
            "L'assenza di necrosi"
        ],
        correct: "La capacità di invadere i tessuti circostanti e metastatizzare"
    },
    {
        q: "Il termine 'carcinoma in situ' si riferisce a:",
        options: [
            "Un tumore che ha superato la membrana basale ma non ha dato metastasi",
            "Una displasia a tutto spessore dell'epitelio che non ha oltrepassato la membrana basale",
            "Un tumore benigno di origine ghiandolare",
            "Una metaplasia squamosa"
        ],
        correct: "Una displasia a tutto spessore dell'epitelio che non ha oltrepassato la membrana basale"
    },

    // --- SISTEMICA: CUORE E VASI ---
    {
        q: "Qual è l'evento iniziale critico nella patogenesi dell'aterosclerosi secondo l'ipotesi della risposta al danno?",
        options: [
            "Accumulo di macrofagi nell'intima",
            "Proliferazione delle cellule muscolari lisce",
            "Danno o disfunzione endoteliale cronica",
            "Calcificazione della media"
        ],
        correct: "Danno o disfunzione endoteliale cronica"
    },
    {
        q: "Nell'infarto del miocardio, qual è il range temporale in cui il danno ai miocardiociti diventa irreversibile dopo l'occlusione coronarica?",
        options: [
            "1-2 minuti",
            "20-40 minuti",
            "6-12 ore",
            "24-48 ore"
        ],
        correct: "20-40 minuti"
    },
    {
        q: "Quale valvulopatia è tipicamente associata alla malattia reumatica cardiaca?",
        options: [
            "Stenosi della mitrale (spesso con fusione delle commissure)",
            "Stenosi della polmonare",
            "Insufficienza della tricuspide isolata",
            "Calcificazione senile della valvola aortica"
        ],
        correct: "Stenosi della mitrale (spesso con fusione delle commissure)"
    },

    // --- SISTEMICA: POLMONE ---
    {
        q: "Come viene definito l'enfisema polmonare dal punto di vista anatomopatologico?",
        options: [
            "Ipertrofia delle ghiandole mucose bronchiali",
            "Infiammazione cronica delle vie aeree con broncospasmo reversibile",
            "Dilatazione anomala e permanente degli spazi aerei distali al bronchiolo terminale con distruzione delle loro pareti",
            "Presenza di essudato purulento negli alveoli"
        ],
        correct: "Dilatazione anomala e permanente degli spazi aerei distali al bronchiolo terminale con distruzione delle loro pareti"
    },
    {
        q: "Qual è il tipo istologico più comune di carcinoma polmonare associato al fumo di sigaretta?",
        options: [
            "Adenocarcinoma",
            "Carcinoma a piccole cellule (microcitoma) e Carcinoma squamoso",
            "Mesotelioma",
            "Tumore carcinoide"
        ],
        correct: "Carcinoma a piccole cellule (microcitoma) e Carcinoma squamoso"
    },

    // --- SISTEMICA: FEGATO E GI ---
    {
        q: "Quale cellula epatica è la principale responsabile della deposizione di collagene (fibrosi) nella cirrosi epatica?",
        options: [
            "Epatocita",
            "Cellula di Kupffer",
            "Cellula stellata epatica (di Ito)",
            "Cellula endoteliale sinusoidale"
        ],
        correct: "Cellula stellata epatica (di Ito)"
    },
    {
        q: "L'esofago di Barrett è una complicanza del reflusso gastroesofageo cronico definita da:",
        options: [
            "Metaplasia intestinale dell'epitelio squamoso distale dell'esofago",
            "Ulcera peptica perforata",
            "Presenza di varici esofagee",
            "Ipertrofia della muscolatura esofagea"
        ],
        correct: "Metaplasia intestinale dell'epitelio squamoso distale dell'esofago"
    },
    {
        q: "Nella pancreatite acuta, qual è il meccanismo patogenetico centrale?",
        options: [
            "Infezione batterica diretta",
            "Autodigestione del tessuto pancreatico da parte di enzimi attivati inappropiatamente",
            "Reazione autoimmune contro le cellule beta",
            "Ischemia mesenterica"
        ],
        correct: "Autodigestione del tessuto pancreatico da parte di enzimi attivati inappropiatamente"
    },

    // --- SISTEMICA: RENE ---
    {
        q: "Qual è la caratteristica clinica distintiva della Sindrome Nefrosica?",
        options: [
            "Ematuria macroscopica e ipertensione",
            "Proteinuria massiva (>3,5 g/die), ipoalbuminemia ed edema",
            "Oliguria acuta e iperazotemia",
            "Piuria e batteriuria"
        ],
        correct: "Proteinuria massiva (>3,5 g/die), ipoalbuminemia ed edema"
    },
    {
        q: "La necrosi tubulare acuta (NTA) è la causa più comune di:",
        options: [
            "Insufficienza renale cronica",
            "Insufficienza renale acuta intrarenale",
            "Sindrome nefritica",
            "Pielonefrite cronica"
        ],
        correct: "Insufficienza renale acuta intrarenale"
    },

    // --- IMMUNOLOGIA E GENETICA ---
    {
        q: "Nelle reazioni di ipersensibilità di Tipo I (Immediata), quale immunoglobulina media la risposta legandosi ai mastociti?",
        options: [
            "IgG",
            "IgM",
            "IgA",
            "IgE"
        ],
        correct: "IgE"
    },
    {
        q: "La fibrosi cistica è causata da una mutazione nel gene CFTR che regola il trasporto di:",
        options: [
            "Ioni Sodio e Potassio",
            "Ioni Cloro",
            "Glucosio",
            "Aminoacidi"
        ],
        correct: "Ioni Cloro"
    },

    // --- ENDOCRINO ---
    {
        q: "Nel Diabete Mellito di tipo 2, qual è il difetto fisiopatologico primario iniziale?",
        options: [
            "Distruzione autoimmune delle cellule beta pancreatiche",
            "Insulino-resistenza dei tessuti periferici e relativa disfunzione delle cellule beta",
            "Assenza totale di insulina",
            "Eccessiva produzione di glucagone"
        ],
        correct: "Insulino-resistenza dei tessuti periferici e relativa disfunzione delle cellule beta"
    },
    {
        q: "La Tiroidite di Hashimoto è caratterizzata istologicamente da:",
        options: [
            "Infiltrato infiammatorio acuto con ascessi",
            "Intenso infiltrato linfocitario con formazione di centri germinativi e cellule di Hürthle",
            "Fibrosi massiva che sostituisce la ghiandola (tiroidite lignea)",
            "Granulomi con cellule giganti multinucleate"
        ],
        correct: "Intenso infiltrato linfocitario con formazione di centri germinativi e cellule di Hürthle"
    },
    {
        q: "Qual è la causa più frequente della sindrome di Cushing endogena?",
        options: [
            "Adenoma surrenalico secernente cortisolo",
            "Carcinoma surrenalico",
            "Iperproduzione di ACTH da parte di un adenoma ipofisario (Malattia di Cushing)",
            "Secrezione ectopica di ACTH (es. carcinoma polmonare)"
        ],
        correct: "Iperproduzione di ACTH da parte di un adenoma ipofisario (Malattia di Cushing)"
    },

    // --- EMATOLOGIA E LINFONODI ---
    {
        q: "La presenza di cellule di Reed-Sternberg è patognomonica per:",
        options: [
            "Linfoma di Burkitt",
            "Linfoma Follicolare",
            "Linfoma di Hodgkin",
            "Leucemia Linfatica Cronica"
        ],
        correct: "Linfoma di Hodgkin"
    },
    {
        q: "Nell'anemia megaloblastica, la caratteristica morfologica principale dei precursori eritroidi è:",
        options: [
            "Microcitosi e ipocromia",
            "Asincronia di maturazione nucleo-citoplasmatica (nucleo immaturo, citoplasma maturo)",
            "Presenza di sferociti",
            "Presenza di cellule a falce"
        ],
        correct: "Asincronia di maturazione nucleo-citoplasmatica (nucleo immaturo, citoplasma maturo)"
    },
    {
        q: "La Leucemia Mieloide Cronica (LMC) è contraddistinta dalla presenza del cromosoma Philadelphia, che risulta dalla traslocazione:",
        options: [
            "t(8;14) coinvolgendo c-MYC",
            "t(9;22) creando il gene di fusione BCR-ABL",
            "t(15;17) coinvolgendo il recettore dell'acido retinoico",
            "t(14;18) coinvolgendo BCL-2"
        ],
        correct: "t(9;22) creando il gene di fusione BCR-ABL"
    },
    // --- PATOLOGIA GENERALE: Accumuli e Invecchiamento ---
    {
        q: "Quale pigmento 'da usura', costituito da polimeri di lipidi e fosfolipidi complessati con proteine, si accumula nei lisosomi di cellule senescenti o atrofiche?",
        options: ["Antracosi", "Lipofuscina", "Emosiderina", "Bilirubina"],
        correct: "Lipofuscina"
    },
    {
        q: "La calcificazione distrofica si differenzia dalla calcificazione metastatica perché:",
        options: [
            "Avviene in tessuti normali a causa di ipercalcemia",
            "Avviene in tessuti necrotici o danneggiati con livelli sierici di calcio normali",
            "È causata esclusivamente da un eccesso di Vitamina D",
            "Si riscontra solo nei calcoli renali"
        ],
        correct: "Avviene in tessuti necrotici o danneggiati con livelli sierici di calcio normali"
    },

    // --- IMMUNOPATOLOGIA AVANZATA ---
    {
        q: "Nelle malattie autoimmuni, il fenomeno del 'molecular mimicry' (mimetismo molecolare) consiste nel:",
        options: [
            "Fatto che i microbi possiedono epitopi che cross-reagiscono con gli antigeni self",
            "Il rilascio di antigeni sequestrati dopo un trauma",
            "L'attivazione dei linfociti B da parte dei superantigeni",
            "La mutazione somatica dei recettori dei linfociti T"
        ],
        correct: "Fatto che i microbi possiedono epitopi che cross-reagiscono con gli antigeni self"
    },
    // --- PATOLOGIA GENERALE: Accumuli e Invecchiamento ---
    {
        q: "Quale pigmento 'da usura', costituito da polimeri di lipidi e fosfolipidi complessati con proteine, si accumula nei lisosomi di cellule senescenti?",
        options: ["Antracosi", "Lipofuscina", "Emosiderina", "Bilirubina"],
        correct: "Lipofuscina"
    },
    {
        q: "La calcificazione distrofica si differenzia dalla calcificazione metastatica perché:",
        options: [
            "Avviene in tessuti normali a causa di ipercalcemia",
            "Avviene in tessuti necrotici o danneggiati con livelli sierici di calcio normali",
            "È causata esclusivamente da un eccesso di Vitamina D",
            "Si riscontra solo nei calcoli renali"
        ],
        correct: "Avviene in tessuti necrotici o danneggiati con livelli sierici di calcio normali"
    },

    // --- IMMUNOPATOLOGIA ---
    {
        q: "Qual è il meccanismo patogenetico della Miastenia Gravis (Ipersensibilità di tipo II)?",
        options: [
            "Lisi cellulare mediata dal complemento",
            "Anticorpi che bloccano o distruggono i recettori dell'acetilcolina nella giunzione neuromuscolare",
            "Formazione di complessi immuni circolanti",
            "Attivazione di linfociti T citotossici contro i muscoli"
        ],
        correct: "Anticorpi che bloccano o distruggono i recettori dell'acetilcolina nella giunzione neuromuscolare"
    },
    {
        q: "Quale citochina è considerata il 'master regulator' della fibrosi nell'infiammazione cronica?",
        options: ["IL-1", "TNF-alpha", "TGF-beta", "IFN-gamma"],
        correct: "TGF-beta"
    },

    // --- NEOPLASIE (Meccanismi molecolari) ---
    {
        q: "Cosa si intende per 'Effetto Warburg' nelle cellule neoplastiche?",
        options: [
            "La capacità di evadere l'apoptosi tramite BCL-2",
            "Il passaggio al metabolismo glicolitico anche in presenza di ossigeno (glicolisi aerobica)",
            "La secrezione di fattori angiogenetici come il VEGF",
            "Il accorciamento dei telomeri dopo ogni divisione"
        ],
        correct: "Il passaggio al metabolismo glicolitico anche in presenza di ossigeno (glicolisi aerobica)"
    },
    {
        q: "Quale via di segnalazione oncogenica è attivata dalla mutazione del gene BRAF (comune nel melanoma)?",
        options: ["Via delle MAPK", "Via Wnt/Beta-catenina", "Via Notch", "Via JAK/STAT"],
        correct: "Via delle MAPK"
    },

    // --- MALATTIE GENETICHE E PEDIATRICHE ---
    {
        q: "Nella Sindrome di Marfan, la mutazione del gene della Fibrillina-1 porta a un indebolimento del connettivo e a:",
        options: [
            "Iperattivazione del segnale del TGF-beta",
            "Carenza di collagene di tipo I",
            "Accumulo di glicogeno nel fegato",
            "Sostituzione ossea con tessuto fibroso"
        ],
        correct: "Iperattivazione del segnale del TGF-beta"
    },

    // --- VASI E CUORE ---
    {
        q: "L'aneurisma dell'aorta addominale è più frequentemente causato da:",
        options: ["Sifilide terziaria", "Aterosclerosi", "Ipertensione maligna", "Difetti congeniti della media"],
        correct: "Aterosclerosi"
    },
    {
        q: "La cardiomiopatia ipertrofica (HCM) è causata principalmente da mutazioni in geni che codificano per:",
        options: [
            "Proteine del citoscheletro (Distrofina)",
            "Proteine del sarcomero (es. catena pesante della beta-miosina)",
            "Canali del calcio",
            "Enzimi lisosomiali"
        ],
        correct: "Proteine del sarcomero (es. catena pesante della beta-miosina)"
    },

    // --- APPARATO RESPIRATORIO ---
    {
        q: "Qual è la lesione elementare della sarcoidosi a livello polmonare?",
        options: [
            "Granuloma necrotizzante (caseoso)",
            "Granuloma non necrotizzante (non caseoso)",
            "Fibrosi interstiziale diffusa (UIP)",
            "Essudato intra-alveolare"
        ],
        correct: "Granuloma non necrotizzante (non caseoso)"
    },
    {
        q: "La sindrome da distress respiratorio acuto (ARDS) è caratterizzata morfologicamente da:",
        options: [
            "Iperplasia delle cellule caliciformi",
            "Formazione di membrane ialine lungo le pareti alveolari",
            "Infiltrato eosinofilo massivo",
            "Bronchiettasie diffuse"
        ],
        correct: "Formazione di membrane ialine lungo le pareti alveolari"
    },

    // --- APPARATO DIGERENTE ---
    {
        q: "Qual è la differenza istologica chiave tra Morbo di Crohn e Rettocolite Ulcerosa (RCU)?",
        options: [
            "La RCU è transmurale, il Crohn è limitato alla mucosa",
            "Il Crohn presenta infiammazione transmurale e granulomi; la RCU è limitata a mucosa e sottomucosa",
            "Solo la RCU aumenta il rischio di adenocarcinoma",
            "Il Crohn colpisce solo il retto"
        ],
        correct: "Il Crohn presenta infiammazione transmurale e granulomi; la RCU è limitata a mucosa e sottomucosa"
    },
    {
        q: "Quale microrganismo è il principale fattore eziologico per l'ulcera peptica e l'adenocarcinoma gastrico?",
        options: ["Escherichia coli", "Helicobacter pylori", "Salmonella typhi", "Giardia lamblia"],
        correct: "Helicobacter pylori"
    },

    // --- FEGATO E VIE BILIARI ---
    {
        q: "Quale marker sierologico indica una replicazione virale attiva nell'Epatite B?",
        options: ["HBsAb", "HBeAg", "HBcAb (IgG)", "HBsAg"],
        correct: "HBeAg"
    },
    {
        q: "L'emocromatosi ereditaria è causata da un eccessivo assorbimento di:",
        options: ["Rame", "Calcio", "Ferro", "Magnesio"],
        correct: "Ferro"
    },

    // --- RENE E VIE URINARIE ---
    {
        q: "La glomerulonefrite a lesioni minime (MCD) è caratterizzata al microscopio elettronico da:",
        options: [
            "Sdoppiamento della membrana basale",
            "Scomparsa (effacement) dei processi citoplasmatici dei podociti",
            "Depositi 'a gobba' (humps) subepiteliali",
            "Proliferazione extracapillare a semiluna"
        ],
        correct: "Scomparsa (effacement) dei processi citoplasmatici dei podociti"
    },
    {
        q: "Il tumore di Wilms (nefroblastoma) è il tumore renale primitivo più comune in:",
        options: ["Anziani (>70 anni)", "Pazienti in dialisi", "Bambini", "Giovani adulti"],
        correct: "Bambini"
    },

    // --- APPARATO GENITALE ---
    {
        q: "Quali ceppi di Papillomavirus Umano (HPV) sono considerati ad alto rischio per il carcinoma della cervice?",
        options: ["6 e 11", "16 e 18", "1 e 2", "21 e 22"],
        correct: "16 e 18"
    },
    {
        q: "I leiomiomi (fibromi) sono tumori benigni che originano da:",
        options: ["Epitelio ghiandolare endometriale", "Cellule stromali dell'ovaio", "Cellule muscolari lisce del miometrio", "Tessuto adiposo pelvico"],
        correct: "Cellule muscolari lisce del miometrio"
    },

    // --- MAMMELLA ---
    {
        q: "Qual è il sottotipo istologico più comune di tumore maligno della mammella?",
        options: [
            "Carcinoma lobulare in situ",
            "Carcinoma duttale infiltrante (NOS)",
            "Carcinoma midollare",
            "Tumore filloide"
        ],
        correct: "Carcinoma duttale infiltrante (NOS)"
    },

    // --- SISTEMA ENDOCRINO ---
    {
        q: "Qual è il carcinoma tiroideo più comune, spesso associato a radiazioni ionizzanti e caratterizzato da nuclei 'a vetro smerigliato'?",
        options: ["Midollare", "Follicolare", "Papillare", "Anaplastico"],
        correct: "Papillare"
    },
    {
        q: "Il Feocromocitoma è un tumore che origina da:",
        options: [
            "Corteccia surrenale",
            "Cellule cromaffini della midollare del surrene",
            "Ipofisi anteriore",
            "Cellule C della tiroide"
        ],
        correct: "Cellule cromaffini della midollare del surrene"
    },

    // --- SISTEMA NERVOSO ---
    {
        q: "Le placche neuritiche (amiloidi) e i grovigli neurofibrillari (proteina Tau) sono tipici di:",
        options: ["Morbo di Parkinson", "Sclerosi Multipla", "Malattia di Alzheimer", "Sclerosi Laterale Amiotrofica"],
        correct: "Malattia di Alzheimer"
    },
    {
        q: "Qual è il tumore cerebrale primitivo più aggressivo nell'adulto?",
        options: ["Meningioma", "Ependimoma", "Glioblastoma multiforme", "Oligodendroglioma"],
        correct: "Glioblastoma multiforme"
    },

    // --- SISTEMA MUSCOLO-SCHELETRICO ---
    {
        q: "L'Osteosarcoma colpisce tipicamente quale regione delle ossa lunghe?",
        options: ["Diafisi", "Metafisi", "Epifisi", "Solo le piccole ossa del carpo"],
        correct: "Metafisi"
    },
    {
        q: "La gotta è causata dal deposito di cristalli di:",
        options: ["Pirofosfato di calcio", "Urato monosodico", "Ossalato di calcio", "Colesterolo"],
        correct: "Urato monosodico"
    },

    // --- CUTE ---
    {
        q: "Qual è il principale fattore prognostico per il Melanoma cutaneo?",
        options: [
            "Il diametro orizzontale",
            "Lo spessore di invasione verticale (Indice di Breslow)",
            "Il colore della lesione",
            "L'età del paziente"
        ],
        correct: "Lo spessore di invasione verticale (Indice di Breslow)"
    },

    // --- MALATTIE INFETTIVE ---
    {
        q: "Nella tubercolosi secondaria, la localizzazione tipica delle lesioni è:",
        options: ["Basi polmonari", "Apici polmonari", "Linfonodi ilari isolati", "Pleura"],
        correct: "Apici polmonari"
    },
    {
        q: "Qual è l'effetto citopatico tipico dell'infezione da Cytomegalovirus (CMV)?",
        options: [
            "Corpi inclusi a 'occhio di bue'",
            "Sincizi multinucleati",
            "Corpi di Negri",
            "Corpi di Councilman"
        ],
        correct: "Corpi inclusi a 'occhio di bue'"
    },
    {
        q: "La fase terziaria della sifilide è caratterizzata da lesioni chiamate:",
        options: ["Sifiloma iniziale", "Gomme sifilitiche", "Condilomi piani", "Roseola"],
        correct: "Gomme sifilitiche"
    }
];

// --- LOGICA DEL QUIZ ---

let attemptQuestions = [];
let currentIndex = 0;
let score = 0;
let errors = [];
let timerInterval;
let timeLeft = 30 * 60; // 30 minuti in secondi

function startAttempt() {
    // Mescola l'ordine delle domande
    attemptQuestions = [...allQuestions].sort(() => Math.random() - 0.5);
    
    currentIndex = 0;
    score = 0;
    errors = [];
    timeLeft = 30 * 60; // Reset tempo a 30 min

    document.getElementById('start-screen').classList.remove('active');
    document.getElementById('quiz-screen').classList.add('active');
    
    startTimer();
    renderQuestion();
}

function startTimer() {
    // Pulisce eventuali timer precedenti per sicurezza
    clearInterval(timerInterval);
    
    timerInterval = setInterval(() => {
        timeLeft--;
        let mins = Math.floor(timeLeft / 60);
        let secs = timeLeft % 60;
        document.getElementById('timer').innerText = `Tempo: ${mins}:${secs < 10 ? '0' : ''}${secs}`;
        
        if (timeLeft <= 0) {
            endAttempt("Tempo scaduto!");
        }
    }, 1000);
}

function renderQuestion() {
    if (currentIndex >= attemptQuestions.length) {
        endAttempt("Quiz completato!");
        return;
    }

    document.getElementById('next-btn').style.display = "none";
    document.getElementById('q-idx').innerText = (currentIndex + 1) + "/" + attemptQuestions.length;
    
    const qObj = attemptQuestions[currentIndex];
    document.getElementById('question').innerText = qObj.q;
    
    const optionsDiv = document.getElementById('options');
    optionsDiv.innerHTML = "";

    // Copia le opzioni e le mescola per non averle sempre nello stesso ordine
    let currentOptions = [...qObj.options].sort(() => Math.random() - 0.5);

    currentOptions.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.innerText = choice;
        btn.onclick = () => checkAnswer(btn, choice, qObj);
        optionsDiv.appendChild(btn);
    });
}

function checkAnswer(btn, choice, qObj) {
    const allBtns = document.querySelectorAll('.option');
    // Disabilita tutti i pulsanti dopo la scelta
    allBtns.forEach(b => b.disabled = true);

    if (choice === qObj.correct) {
        btn.classList.add('correct');
        score++;
    } else {
        btn.classList.add('wrong');
        errors.push({
            q: qObj.q, 
            correct: qObj.correct, 
            your: choice
        });
        
        // Evidenzia automaticamente la risposta corretta se l'utente ha sbagliato
        allBtns.forEach(b => { 
            if(b.innerText === qObj.correct) b.classList.add('correct'); 
        });
    }
    
    currentIndex++;
    document.getElementById('next-btn').style.display = "block";
}

function endAttempt(reason) {
    clearInterval(timerInterval);
    
    // Se il tempo scade, segna le domande mancanti come "Non risposte"
    if (currentIndex < attemptQuestions.length) {
        for (let i = currentIndex; i < attemptQuestions.length; i++) {
            errors.push({
                q: attemptQuestions[i].q, 
                correct: attemptQuestions[i].correct, 
                your: "Non risposta (tempo scaduto)"
            });
        }
    }

    document.getElementById('quiz-screen').classList.remove('active');
    document.getElementById('result-screen').classList.add('active');
    
    // Calcolo percentuale
    let percentage = Math.round((score / attemptQuestions.length) * 100);
    document.getElementById('final-score').innerText = `${reason} Punteggio: ${score}/${attemptQuestions.length} (${percentage}%)`;
    
    const errorList = document.getElementById('error-list');
    errorList.innerHTML = "";
    
    if(errors.length === 0) {
        errorList.innerHTML = "<p style='color:var(--success); text-align:center;'>Nessun errore! Eccellente!</p>";
    } else {
        errors.forEach(err => {
            errorList.innerHTML += `
                <div class="review-item">
                    <div class="review-q">${err.q}</div>
                    <div class="review-user">Tua risposta: ${err.your}</div>
                    <div class="review-a">Risposta corretta: ${err.correct}</div>
                </div>`;
        });
    }
}
</script>
</body>
</html>









